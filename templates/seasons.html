<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Season Statistics</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <style>
    .season-selector{
      background:var(--card);
      padding:16px;
      border-radius:10px;
      border:1px solid #e6eef9;
      margin-bottom:20px;
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }
    .season-selector label{font-weight:600;color:var(--muted)}
    .season-selector select{
      padding:8px 12px;
      border-radius:8px;
      border:1px solid #e6eef9;
      background:var(--bg);
      color:#0f172a;
      font-size:0.95rem;
      cursor:pointer;
    }
    .season-info{
      background:var(--card);
      padding:16px;
      border-radius:10px;
      border:1px solid #e6eef9;
      margin-bottom:20px;
    }
    .season-info h2{margin:0 0 12px 0;font-size:1.3rem;color:var(--accent)}
    .info-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
      gap:12px;
      margin-top:12px;
    }
    .info-item{
      background:var(--glass);
      padding:10px;
      border-radius:6px;
    }
    .info-label{font-size:0.85rem;color:var(--muted);margin-bottom:4px}
    .info-value{font-size:1.1rem;font-weight:600}
    
    .status-badge{
      display:inline-block;
      padding:4px 10px;
      border-radius:12px;
      font-size:0.85rem;
      font-weight:600;
    }
    .status-completed{background:#d1fae5;color:#065f46}
    .status-active{background:#dbeafe;color:#1e40af}
    .status-upcoming{background:#fef3c7;color:#92400e}
    
    .stats-section{
      background:var(--card);
      padding:16px;
      border-radius:10px;
      border:1px solid #e6eef9;
      margin-bottom:20px;
    }
    .stats-section h3{margin:0 0 16px 0;font-size:1.1rem;color:#0f172a}
    
    .team-card{
      background:var(--glass);
      padding:12px;
      border-radius:8px;
      margin-bottom:12px;
      border-left:3px solid var(--accent);
    }
    .team-name{font-weight:700;color:var(--accent);margin-bottom:8px;font-size:1.05rem}
    .team-members{color:var(--muted);font-size:0.9rem;margin-bottom:8px}
    .team-stats{display:flex;gap:16px;font-size:0.9rem;flex-wrap:wrap}
    .team-stat-item{display:flex;flex-direction:column}
    .team-stat-label{color:var(--muted);font-size:0.8rem}
    .team-stat-value{font-weight:600;margin-top:2px}
    
    .match-list{list-style:none;padding:0;margin:0}
    .match-item{
      background:var(--glass);
      padding:12px;
      border-radius:6px;
      margin-bottom:8px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:8px;
    }
    .match-result{font-weight:600}
    .match-winner{color:#10b981}
    .match-loser{color:var(--muted)}
    .match-date{color:var(--muted);font-size:0.85rem}
    
    .empty-state{
      text-align:center;
      padding:40px 20px;
      color:var(--muted);
      font-style:italic;
    }
    
    nav{margin-top:12px}
    nav a{color:var(--accent);text-decoration:none;font-size:0.95rem;margin:0 8px}
    nav a:hover{text-decoration:underline}
    nav span{color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <h1>Season Statistics</h1>
    <nav>
      <a href="/">‚Üê Leaderboard</a>
      <span>|</span>
      <a href="/seasons">Season Stats</a>
    </nav>
    <p class="subtitle">View detailed statistics for each season including player rankings, teams, and match history.</p>
  </header>

  <main>
    <section class="season-selector">
      <label for="seasonSelect">Select Season:</label>
      <select id="seasonSelect">
        <option value="">Loading seasons...</option>
      </select>
    </section>

    <div id="seasonContent">
      <div class="empty-state">Select a season to view statistics</div>
    </div>
  </main>

  <footer style="text-align:center;padding:20px;color:var(--muted)">
    <small>Season statistics powered by Flask backend.</small>
  </footer>

  <script>
    let seasonsData = null;

    async function loadSeasonData() {
      // Hardcoded season data from sample_season.json
      seasonsData = {
  "seasons": [
    {
      "seasonId": "fall-2024",
      "seasonName": "Fall 2024",
      "startDate": "2024-09-01",
      "endDate": "2024-11-30",
      "status": "completed",
      "sport": "basketball",
      "players": [
        {"name": "alice", "winRecord": 10, "lossRecord": 2, "rating": 1580},
        {"name": "bob", "winRecord": 8, "lossRecord": 4, "rating": 1520},
        {"name": "carol", "winRecord": 5, "lossRecord": 1, "rating": 1550},
        {"name": "dave", "winRecord": 2, "lossRecord": 6, "rating": 1400},
        {"name": "eve", "winRecord": 7, "lossRecord": 3, "rating": 1535}
      ],
      "matches": [
        {"matchId": 1, "winner": "alice", "loser": "bob", "date": "2024-09-05"},
        {"matchId": 2, "winner": "carol", "loser": "dave", "date": "2024-09-07"},
        {"matchId": 3, "winner": "alice", "loser": "eve", "date": "2024-09-10"}
      ]
    },
    {
      "seasonId": "winter-2024",
      "seasonName": "Winter 2024-2025",
      "startDate": "2024-12-01",
      "endDate": "2025-02-28",
      "status": "active",
      "sport": "basketball",
      "players": [
        {"name": "alice", "winRecord": 4, "lossRecord": 1, "rating": 1545},
        {"name": "bob", "winRecord": 3, "lossRecord": 2, "rating": 1510},
        {"name": "carol", "winRecord": 2, "lossRecord": 3, "rating": 1485},
        {"name": "dave", "winRecord": 1, "lossRecord": 4, "rating": 1465},
        {"name": "frank", "winRecord": 5, "lossRecord": 0, "rating": 1590}
      ],
      "matches": [
        {"matchId": 1, "winner": "alice", "loser": "dave", "date": "2024-12-03"},
        {"matchId": 2, "winner": "frank", "loser": "bob", "date": "2024-12-05"},
        {"matchId": 3, "winner": "frank", "loser": "carol", "date": "2024-12-08"}
      ]
    },
    {
      "seasonId": "spring-2025",
      "seasonName": "Spring 2025",
      "startDate": "2025-03-01",
      "endDate": "2025-05-31",
      "status": "upcoming",
      "sport": "basketball",
      "players": [],
      "matches": []
    }
  ],
  "teams": [
    {
      "seasonId": "fall-2024",
      "teams": [
        {"teamName": "Thunder", "members": ["alice", "bob"], "winRecord": 6, "lossRecord": 2, "rating": 1550},
        {"teamName": "Lightning", "members": ["carol", "dave"], "winRecord": 3, "lossRecord": 5, "rating": 1475}
      ]
    },
    {
      "seasonId": "winter-2024",
      "teams": [
        {"teamName": "Thunder", "members": ["alice", "frank"], "winRecord": 4, "lossRecord": 0, "rating": 1567},
        {"teamName": "Storm", "members": ["bob", "carol"], "winRecord": 2, "lossRecord": 2, "rating": 1497}
      ]
    }
  ],
  "metadata": {
    "currentSeasonId": "winter-2024",
    "totalSeasons": 3,
    "lastUpdated": "2024-12-15T10:30:00Z"
  }
};
      populateSeasonSelector();
    }

    function populateSeasonSelector() {
      const select = document.getElementById('seasonSelect');
      select.innerHTML = '<option value="">-- Select a season --</option>';
      
      seasonsData.seasons.forEach(season => {
        const option = document.createElement('option');
        option.value = season.seasonId;
        option.textContent = season.seasonName;
        if (season.seasonId === seasonsData.metadata.currentSeasonId) {
          option.textContent += ' (Current)';
        }
        select.appendChild(option);
      });

      select.value = seasonsData.metadata.currentSeasonId;
      displaySeason(seasonsData.metadata.currentSeasonId);
    }

    function getStatusBadgeClass(status) {
      return `status-badge status-${status}`;
    }

    function calculateWinRate(wins, losses) {
      const total = wins + losses;
      return total === 0 ? 0 : (wins / total * 100);
    }

    function displaySeason(seasonId) {
      if (!seasonId) {
        document.getElementById('seasonContent').innerHTML = 
          '<div class="empty-state">Select a season to view statistics</div>';
        return;
      }

      const season = seasonsData.seasons.find(s => s.seasonId === seasonId);
      if (!season) return;

      const teams = seasonsData.teams.find(t => t.seasonId === seasonId);
      const sortedPlayers = [...season.players].sort((a, b) => {
        if (b.rating !== a.rating) return b.rating - a.rating;
        const wrB = calculateWinRate(b.winRecord, b.lossRecord);
        const wrA = calculateWinRate(a.winRecord, a.lossRecord);
        if (wrB !== wrA) return wrB - wrA;
        if (b.winRecord !== a.winRecord) return b.winRecord - a.winRecord;
        return a.lossRecord - b.lossRecord;
      });

      let html = `
        <div class="season-info">
          <h2>${season.seasonName}</h2>
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Status</div>
              <div class="info-value">
                <span class="${getStatusBadgeClass(season.status)}">
                  ${season.status.charAt(0).toUpperCase() + season.status.slice(1)}
                </span>
              </div>
            </div>
            <div class="info-item">
              <div class="info-label">Sport</div>
              <div class="info-value">${season.sport.charAt(0).toUpperCase() + season.sport.slice(1)}</div>
            </div>
            <div class="info-item">
              <div class="info-label">Start Date</div>
              <div class="info-value">${new Date(season.startDate).toLocaleDateString()}</div>
            </div>
            <div class="info-item">
              <div class="info-label">End Date</div>
              <div class="info-value">${new Date(season.endDate).toLocaleDateString()}</div>
            </div>
            <div class="info-item">
              <div class="info-label">Total Players</div>
              <div class="info-value">${season.players.length}</div>
            </div>
            <div class="info-item">
              <div class="info-label">Total Matches</div>
              <div class="info-value">${season.matches.length}</div>
            </div>
          </div>
        </div>
      `;

      if (sortedPlayers.length > 0) {
        html += `
          <div class="stats-section">
            <h3>Player Standings</h3>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Rank</th>
                    <th>Name</th>
                    <th>Rating</th>
                    <th>Wins</th>
                    <th>Losses</th>
                    <th>Win rate</th>
                  </tr>
                </thead>
                <tbody>
        `;
        
        sortedPlayers.forEach((player, index) => {
          const winRate = calculateWinRate(player.winRecord, player.lossRecord);
          html += `
            <tr>
              <td class="rank">${index + 1}</td>
              <td class="name">${player.name}</td>
              <td>${player.rating.toFixed(0)}</td>
              <td>${player.winRecord}</td>
              <td>${player.lossRecord}</td>
              <td>${winRate.toFixed(1)}%</td>
            </tr>
          `;
        });
        
        html += `
                </tbody>
              </table>
            </div>
          </div>
        `;
      } else {
        html += `
          <div class="stats-section">
            <h3>Player Standings</h3>
            <div class="empty-state">No players in this season yet</div>
          </div>
        `;
      }

      if (teams && teams.teams.length > 0) {
        html += `
          <div class="stats-section">
            <h3>Team Standings</h3>
        `;
        
        const sortedTeams = [...teams.teams].sort((a, b) => b.rating - a.rating);
        sortedTeams.forEach(team => {
          const teamWinRate = calculateWinRate(team.winRecord, team.lossRecord);
          html += `
            <div class="team-card">
              <div class="team-name">${team.teamName}</div>
              <div class="team-members">Members: ${team.members.join(', ')}</div>
              <div class="team-stats">
                <div class="team-stat-item">
                  <span class="team-stat-label">Rating</span>
                  <span class="team-stat-value" style="color:var(--accent)">${team.rating.toFixed(0)}</span>
                </div>
                <div class="team-stat-item">
                  <span class="team-stat-label">Wins</span>
                  <span class="team-stat-value" style="color:#10b981">${team.winRecord}</span>
                </div>
                <div class="team-stat-item">
                  <span class="team-stat-label">Losses</span>
                  <span class="team-stat-value" style="color:#ef4444">${team.lossRecord}</span>
                </div>
                <div class="team-stat-item">
                  <span class="team-stat-label">Win Rate</span>
                  <span class="team-stat-value">${teamWinRate.toFixed(1)}%</span>
                </div>
              </div>
            </div>
          `;
        });
        
        html += `</div>`;
      }

      if (season.matches.length > 0) {
        html += `
          <div class="stats-section">
            <h3>Match History</h3>
            <ul class="match-list">
        `;
        
        const sortedMatches = [...season.matches].sort((a, b) => 
          new Date(b.date) - new Date(a.date)
        );
        
        sortedMatches.forEach(match => {
          html += `
            <li class="match-item">
              <div class="match-result">
                <span class="match-winner">${match.winner}</span>
                <span> defeated </span>
                <span class="match-loser">${match.loser}</span>
              </div>
              <div class="match-date">${new Date(match.date).toLocaleDateString()}</div>
            </li>
          `;
        });
        
        html += `
            </ul>
          </div>
        `;
      } else {
        html += `
          <div class="stats-section">
            <h3>Match History</h3>
            <div class="empty-state">No matches recorded yet</div>
          </div>
        `;
      }

      document.getElementById('seasonContent').innerHTML = html;
    }

    document.getElementById('seasonSelect').addEventListener('change', (e) => {
      displaySeason(e.target.value);
    });

    loadSeasonData();
  </script>
</body>
</html>